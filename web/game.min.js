function e(e,t,a,r){return Math.abs(a-e)+Math.abs(r-t)}let t=[1,9,0,0,1,0,1,0,9,0,0,1,0,0,0,0,1,9,1,0,1,1,1,0,1,9,0,0,1,0,0,1,9,1,0,0,0,1,1,9,0,1,1,9,1,1,0,0,0,1,1,0,9,0,9,0,1,1,1,0,1,0,1,1,1,9,0,1,0,1,1,0,1,9,1,0,9,0,9,1,1,9,1,1,1,0,9,9,1,9,1,9,1,9,0,0,1,9,0,1,9,1,0,1,1,1,0,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,9,1,9,1,1,1,1,9,0,9,0,1,0,9,0,0,1,0,1,1,1,1,0,0,1,0,0,1,1,0,0,0,1,1,1,1,9,9,1,1,1,9,1,0,9,9,1,0,9,1,9,0,0,0,9,0,0,9,1,1,1,1,1,9,0,1,9,0,9,0,0,1,1,1,0,1,0,1,0,0,9,1,1,0,0,1,0,0,9,0,1,0,9,1,0,0,1,0,1,0,9,0,1],a=[1,0,1,9,0,1,9,9,1,1,9,9,0,1,9,1,1,0,0,1,0,1,1,0,9,0,9,1,1,9,0,1,1,0,1,1,1,9,0,0,1,1,9,1,1,0,1,9,1,1,9,0,0,9,1,9,1,1,0,0,1,9,0,0,9,1,1,0,1,0,1,1,0,9,1,0,0,1,9,1,1,1,0,0,1,0,0,1,1,9,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,1,0,1,9,0,0,9,0,0,9,0,1,0,0,9,1,1,1,9,9,1,1,1,0,9,0,1,0,0,1,9,1,1,1,1,9,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,1,0,9,1,1,1,9,1,0,1,1,0,9,1,1,0,0,0,0,0,1,0,1,1,0,9,9,1,1,1,9,1,1,9,9,1,1,9,1,9,0,9,1,1,9,1,1,0,0,1,9,9,1,9,1,1,9,1],r=[];for(let e=0;e<11;e++)for(let a=0;a<21;a++)r.push(t[21*e+a]),a<20&&r.push(0);let o=[];for(let e=0;e<10;e++)for(let t=0;t<22;t++)o.push(a[22*e+t]),t>0&&t<20&&o.push(1);let n=[];for(let e=0;e<41;e++)n.push(1);for(let e=0;e<21;e++)for(let t=0;t<41;t++)e%2==0?n.push(r[41*Math.floor(e/2)+t]):n.push(o[41*Math.floor(e/2)+t]);for(let e=0;e<41;e++)n.push(1);function s(e){return 1+2*e}function i(e){return 96*Math.floor(e/2)+48}function l(e){return 2*Math.floor(e/96)+1}function c(e){return Math.floor((e-1)/2)}const p={};function h(e){return!!p[e.toUpperCase()]}function f(e,t){return Object.keys(p).find(a=>p[a].x===e&&p[a].y===t)}["A","B","C","D","E","F","G","H","I","J","K"].forEach((e,t)=>{for(let a=0;a<20;a++)p[e+(a+1)]={x:a,y:t}}),window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){try{const e=(await fetch(`${g}/assets/shamelist.txt`).then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(u.channel&&e&&e.includes(u.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),isValid=!1),u.oauth&&(u.oauth=await async function(e,t){const a=localStorage.getItem("pixelplush_token"),r=localStorage.getItem("pixelplush_refresh");if(a){const e=await ge(a);if(console.log("stored access token",e),e&&e.user_id&&e.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t)))return a}if(r){const e=await xe(r);if(console.log("stored refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scope.includes(t)))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}const o=await ge(e);if(console.log("provided access token",o),o&&o.user_id&&o.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(e=>o.scopes.includes(e)))return localStorage.setItem("pixelplush_token",e),localStorage.setItem("pixelplush_refresh",t),e;if(t){const e=await xe(t);if(console.log("provided refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scope.includes(t)))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}return console.log("no valid tokens"),null}(u.oauth.replace("oauth:",""),u.refreshToken)),y.requires)try{if(account=await fetch(`${d}/accounts`,{headers:{Twitch:u.oauth?u.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(y.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:ne,update:le,channel:u.channel,username:u.oauth?u.channel:void 0,password:u.oauth,onCommand:ye,onChat:ue,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,t,a)=>{if(a){let e=await Me();0!==e&&(be=e.session,setInterval(()=>{Me()},6e4))}}}()}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();const d="https://api.pixelplush.dev/v1";let m="Wandering Wizards",y={},u={},g="",x="*BOO*",b="steal",M="points",O=!0,S=3,I=5,$=1,U=PIXI.RenderTexture.create(1920,1080),k=new PIXI.Container,_={};let A=0,w=!1;let j,C,v,E,P,T,L,z,D,N=[],R=[],B="",X=[],F=[],G=[],V=["front","back","left","right"],H=-1,W=-1,Y=null,J={},q={},K=0,Z=[],Q=null,ee=0,te=-1,ae=-1;let re=3e3;n=n.map(e=>9===e?0:e);let oe=[];function ne(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${g}/assets/${y.map}.png`),Unicorn.AddBacklay("map","map",0,0,{scale:{x:3,y:3}}),y.lightCharacters){const e=new PIXI.Graphics;e.beginFill(0,.925),e.drawRect(0,0,1920,1080),e.endFill(),k.addChild(e),k.blendMode=PIXI.BLEND_MODES.ADD}Unicorn.Load("light_glow",`${g}/assets/effects/light_glow.png`),Unicorn.Load("glow",`${g}/assets/effects/lantern_glow.png`),y.glows.forEach((e,t)=>{let a=Unicorn.AddOverlay("lantern"+t,"glow",3*e.x,3*e.y);a.anchor.set(.5),a.scale.x=3,a.scale.y=3;let r=null;y.lightCharacters&&(r=new PIXI.Sprite(assetReference.light_glow),r.position.x=3*e.x,r.position.y=3*e.y,r.scale={x:5,y:5},r.anchor.set(.5),k.addChild(r)),setInterval(()=>{a.alpha=Math.random()<.1?0:1,r&&(r.alpha=a.alpha),setTimeout(()=>{a.alpha=1,r&&(r.alpha=a.alpha)},200+200*Math.random())},500+500*Math.random())}),Unicorn.Load("walls",`${g}/assets/${y.walls}.png`);let e=Unicorn.AddOverlay("walls","walls",0,0);if(e.scale.x=3,e.scale.y=3,y.lanterns){Unicorn.Load("lanterns",`${g}/assets/${y.lanterns}.png`);let e=Unicorn.AddOverlay("lanterns","lanterns",0,0);e.scale.x=3,e.scale.y=3}y.fog.forEach((e,t)=>{Unicorn.Load(`fog${t}`,`${g}/assets/${e}.png`)});for(let e=0;e<11;e++)for(let t=0;t<20;t++){let a=i(s(t)),r=i(s(e))+9,o="fog"+Math.floor(Math.random()*y.fog.length),n=Unicorn.AddOverlay("fog"+t+"_"+e,o,a,r,{z:1});n.scale.x=3,n.scale.y=3,n.anchor.set(.5),8<t&&t<12&&3<e&&e<6&&(n.alpha=0),Math.random()>.15&&(n.alpha=0),G.push(n)}setInterval(ce,1e3),y.numbers?Unicorn.Load("guide",`${g}/assets/${y.numbers}.png`):Unicorn.Load("guide",`${g}/assets/numbers_g.png`);let t=Unicorn.AddOverlay("guide","guide",0,0);t.scale.x=3,t.scale.y=3,Object.keys(y.prizes).forEach(e=>{y.animatedPrizes&&y.animatedPrizes[e]&&Object.keys(y.animatedPrizes[e]).forEach(t=>{for(let a=0;a<y.animatedPrizes[e][t];a++)Unicorn.Load(`${e}_${t}${a}`,`${g}/assets/items/${e}_${t}/${e}_${t}${a+1}.png`)}),Unicorn.Load(e,`${g}/assets/items/${e}.png`)}),Object.keys(y.traps).forEach(e=>{Unicorn.Load(e,`${g}/assets/items/${e}.png`)});for(let e in y.characters)if("ghost"===e){let t=y.characters[e];for(let a=1;a<19;a++)Unicorn.Load(t+(a-1),`${g}/assets/characters/${e}/${t}${a}.png`)}else V.forEach(t=>{let a=y.characters[e]+"_"+t;for(let t=1;t<11;t++)Unicorn.Load(a+(t-1),`${g}/assets/characters/${e}/${a}/${a}${t}.png`)});Unicorn.Load("star_blue",`${g}/assets/icons/star_blue.png`),j=Unicorn.AddOverlay("tagStar","star_blue",-1e3,-1e3),j.scale.x=3,j.scale.y=3,j.anchor.set(.5),Unicorn.Load("star",`${g}/assets/icons/star.png`),z=Unicorn.AddOverlay("star","star",-1e3,-1e3),z.scale.x=3,z.scale.y=3,z.anchor.set(.5),Unicorn.Load("start",`${g}/assets/${y.instructions}.png`),C=Unicorn.AddOverlay("gameStart","start",50,50+(y.instructionsVerticalOffset?y.instructionsVerticalOffset:0),{z:100}),C.scale.x=3,C.scale.y=3,u.showBannerAd&&Unicorn.Load("banner_ad",`${g}/assets/banner.png`),v=Unicorn.AddOverlay("banner_ad","banner_ad",1360,50,{z:101}),v.scale.x=3,v.scale.y=3,y.sleigh&&(Unicorn.Load("sleigh",`${g}/assets/${y.sleigh}.png`),D=Unicorn.AddOverlay("santaSleigh","sleigh",0,-1e3,{z:10}),D.scale.x=3,D.scale.y=3),Unicorn.Load("end_bg",`${g}/assets/${y.endBG}.png`),E=Unicorn.AddOverlay("end_bg","end_bg",0,0,{z:100}),E.scale.x=3,E.scale.y=3,E.alpha=0,y.scoreBoard.forEach((e,t)=>{Unicorn.Load(`scoreboard${t}`,`${g}/assets/${e}.png`);let a=Unicorn.AddOverlay("scoreboard","scoreboard"+t,1280,y.scoreBoardVerticalOffset,{z:100});a.scale.x=3,a.scale.y=3,a.alpha=0,Z.push(a)}),Unicorn.Load("end_sign",`${g}/assets/${y.banner}.png`),T=Unicorn.AddOverlay("end_sign","end_sign",250+(y.bannerHorizontalOffset?y.bannerHorizontalOffset:0),50+(y.bannerVerticalOffset?y.bannerVerticalOffset:0),{z:110}),T.scale.x=3,T.scale.y=3,T.alpha=0,Unicorn.Load("end_note",`${g}/assets/${y.endNote}.png`),P=Unicorn.AddOverlay("end_note","end_note",200,400+(y.endVerticalOffset?y.endVerticalOffset:0),{z:100}),P.scale.x=3,P.scale.y=3,P.alpha=0,L=Unicorn.AddText("scores","Scores:",1400,250+(y.scoresVerticalOffset?y.scoresVerticalOffset:0),{fontFamily:"Pixeltype",fontSize:50,fontWeight:"bold",fill:y.scoreboardColor||"#ffffff",z:100}),L.alpha=0;for(let e=0;e<S;e++)he();for(let e=0;e<I;e++)pe();if(u.addBoss)for(let e=0;e<$;e++)setTimeout(fe,1e3*e);if(y.snow&&Unicorn.AddParticles("snowupdown",{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),y.lightCharacters){app.stage.addChild(t);let e=PIXI.Sprite.from(U);e.blendMode=PIXI.BLEND_MODES.MULTIPLY,groupOverlay.addChild(e);let a=new PIXI.SpriteMaskFilter(PIXI.Sprite.from(U));a.blendMode=PIXI.BLEND_MODES.OVERLAY,groupWorld.filters=[a]}}function se(){O=!0;let e=ie();te=e.x,ae=e.y,ee=3e3}function ie(){let e=Math.floor(20*Math.random()),t=Math.floor(11*Math.random());for(;9<=e&&e<=11&&4<=t&&t<=5;)e=Math.floor(20*Math.random()),t=Math.floor(11*Math.random());return{x:e,y:t}}function le(e,t){if(re>0&&(re-=t),ee>0){let e=1-ee/3e3,a=i(s(te)),r=i(s(ae))+9;e<.5?D.x=(2*a+800+700)*Math.sin(e*Math.PI)/2-800:(O&&(F.some(e=>e.x===te&&e.y===ae)||he(te,ae,B),O=!1,setTimeout(()=>{se()},18e4+12e4*Math.random())),D.x=(2*a+800+700)/2-800+4220*(1-Math.sin(e*Math.PI))/2),D.y=r-100+10*Math.sin(ee/80),ee-=t}for(let e in J){let a=J[e];a.idleTimer>0&&(a.idleTimer-=t);let r=e===Y,o=a.isBoss,n=a.sprite.position.x,s=a.sprite.position.y;if(a.path.length>0)if(a.sprite.animations[a.sprite.currentAnimation].playing||Unicorn.PlayObjectAnimation("player_"+e,a.sprite.currentAnimation),a.progress+=t/1e3*(a.isTeleporting?10:o?.75:r?1.5:1),a.progress>=1){a.progress=0,a.x=a.path[0].x,a.y=a.path[0].y;let t=c(a.x),n=c(a.y);if(w);else if(o);else if(r);else if(!a.isTeleporting){for(let e=0;e<F.length;e++)F[e].x===t&&F[e].y===n&&(a.points+=y.prizes[F[e].type],console.log(a.name+" GOT THE PRIZE AND NOW HAS "+a.points+" points!"),Unicorn.RemoveObject(F[e].sprite.label),F[e].type!==B&&setTimeout(()=>{he()},1e3*(y.prizeRespawnTime||0)),F.splice(e,1),de());for(let r=0;r<X.length;r++)if(X[r].x===t&&X[r].y===n)switch(M){case"tunnel":if(!a.isTeleporting){let t=c(a.x),o=c(a.y),n=X[(r+1)%X.length];if(t!==n.x||o!==n.y){a.path=[];let t=f(n.x,n.y);me(a.username,e,t),a.isTeleporting=!0,console.log(a.name+" HIT A TRAP AND IS TELEPORTING!"),Unicorn.RemoveObject(X[r].sprite.label),X.splice(r,1),pe()}}break;case"points":default:a.points+=y.traps[X[r].type],console.log(a.name+" HIT A TRAP AND NOW HAS "+a.points+" points!"),Unicorn.RemoveObject(X[r].sprite.label),X.splice(r,1),pe(),de()}}Unicorn.SetPosition(a.sprite.label,i(a.x),i(a.y)+9),a.sprite.animations[a.sprite.currentAnimation].zIndex=a.sprite.position.y,a.path.shift(),a.path.shift()}else{let e=a.path[0],t=i(a.x)+a.progress*(i(e.x-a.x)-48),r=i(a.y)+a.progress*(i(e.y-a.y)-48)+9;Unicorn.SetPosition(a.sprite.label,t,r),a.sprite.animations[a.sprite.currentAnimation].zIndex=a.sprite.position.y;let n=c(l(t)+1),s=c(l(r-9)+1);!o&&G[20*s+n].alpha>0&&(G[20*s+n].alpha=Math.min(1-a.progress,G[20*s+n].alpha))}else{if(o&&me(".boss",e,Object.keys(p)[Math.floor(Math.random()*Object.keys(p).length)],y.defaultNameColor||"#ffffff",y.bossCharacter),a.isTeleporting){a.isTeleporting=!1;let e=c(a.x),t=c(a.y);for(let a=0;a<X.length;a++)if(X[a].x===e&&X[a].y===t)switch(M){case"tunnel":Unicorn.RemoveObject(X[a].sprite.label),X.splice(a,1),pe()}}else a.wander&&me(a.username,e,Object.keys(p)[Math.floor(Math.random()*Object.keys(p).length)]);Unicorn.StopObjectAnimation("player_"+e)}if(!w&&o&&re<=0)for(let t in J){let r=J[t];if(t!==e&&!r.isBoss&&r.idleTimer>0&&Math.abs(a.sprite.position.x-r.sprite.position.x)<32&&Math.abs(a.sprite.position.y-r.sprite.position.y)<32)switch(b){case"steal":if(J[t].points>0){let a=Math.min(200,Math.ceil((.1+.4*Math.random())*J[t].points));J[t].points-=a,J[e].points+=a}re=5e3;break;case"base":if(!r.isTeleporting){let e=c(r.x),a=c(r.y);if(!(9<=e&&e<=11&&4<=a&&a<=5)){r.path=[];let e=["E10","E11","E12","F10","F11","F12"];me(r.username,t,e[Math.floor(Math.random()*e.length)]),r.isTeleporting=!0}}break;case"death":J[t].hp>0&&(J[t].hp=0,r.path=[],console.log(r))}}if(!w&&r)for(let t in J){let r=J[t];t!==e&&r.x===a.x&&r.y===a.y&&r.x!==H&&r.y!==W&&(H=r.x,W=r.y,Y=t,console.log("TAG!",Y))}a.label.x=a.sprite.position.x,a.label.x<a.label.width/2+50&&(a.label.x=a.label.width/2+50),a.label.y=a.sprite.position.y-60,a.label.y<80&&(a.label.y=80),a.label.anchor.set(.5),r&&(j.x=a.sprite.position.x,j.y=a.sprite.position.y-30),a.scoreLabel.x=a.label.x,a.scoreLabel.y=a.label.y-(a.label.y<=80?-30:30),a.scoreLabel.text=0===a.points?"":a.points,a.scoreLabel.anchor.set(.5),e===Q&&(z.x=a.label.x-a.label.width/2-20,z.y=a.label.y-5);let h="front";a.sprite.position.x<n?h="left":a.sprite.position.x>n?h="right":a.sprite.position.y<s&&(h="back"),a.direction!==h&&Unicorn.PlayObjectAnimation("player_"+e,h),a.direction=h,_[e]&&(_[e].position.x=a.sprite.position.x,_[e].position.y=a.sprite.position.y),a.isTeleporting?a.sprite.animations[a.sprite.currentAnimation].alpha=.25:a.sprite.animations[a.sprite.currentAnimation].alpha=a.idleTimer>0?1:.5}for(let e in J){let a=J[e];if(a.pet){a.path.length>0&&(a.petIdle=Math.min(a.petIdle,100));let r=!1,o=a.sprite.position.x-a.petSprite.position.x,n=a.sprite.position.y-a.petSprite.position.y,s=o*o+n*n;if(s>1e6)Unicorn.SetPosition(a.petSprite.label,a.sprite.position.x,a.sprite.position.y);else if(s>4e4)a.petIdle=0,a.petSpeed=2,a.petGoalX=a.sprite.position.x+Math.floor(200*Math.random())-100,a.petGoalY=a.sprite.position.y+Math.floor(200*Math.random())-100;else{let o=a.petGoalX-a.petSprite.position.x,n=a.petGoalY-a.petSprite.position.y;o*o+n*n<100&&(Unicorn.StopObjectAnimation("pet_"+e),a.petSprite.animations[a.petSprite.currentAnimation].gotoAndStop(0),a.petIdle>0?(a.petIdle-=t,r=!0):(a.petGoalX=a.sprite.position.x+Math.floor(200*Math.random())-100,a.petGoalY=a.sprite.position.y+Math.floor(200*Math.random())-100,a.petIdle=Math.floor(Math.random()*(y.pets[a.pet].maxIdle-y.pets[a.pet].minIdle))+y.pets[a.pet].minIdle,r=!0,a.petSpeed=1))}a.petDirCD&&a.petDirCD>0&&(a.petDirCD-=t);let i=a.petDirection;if(!r){a.petSprite.position.x,a.petSprite.position.y;let t=a.petGoalX-a.petSprite.position.x,r=a.petGoalY-a.petSprite.position.y,o=Math.sqrt(t*t+r*r);t/=o,r/=o;let n=a.petSprite.position.x+a.petSpeed*t,s=a.petSprite.position.y+a.petSpeed*r;a.petSprite.animations[a.petSprite.currentAnimation].playing||Unicorn.PlayObjectAnimation("pet_"+e,a.petSprite.currentAnimation),Unicorn.SetPosition(a.petSprite.label,n,s),a.petSprite.animations[a.petSprite.currentAnimation].zIndex=a.petSprite.position.y+5,i=Math.abs(t)>Math.abs(r)?t<0?"left":"right":r<0?"back":"front"}a.petDirection!==i&&(!a.petDirCD||a.petDirCD<=0)&&(a.petDirCD=500,Unicorn.PlayObjectAnimation("pet_"+e,i)),a.petDirection=i}}y.lightCharacters&&app.renderer.render(k,U)}function ce(){let e=G[Math.floor(Math.random()*G.length)];if(Math.random()>.15){let t=setInterval(()=>{e.alpha-=.01,e.alpha<=0&&clearInterval(t)},10)}else{let t=setInterval(()=>{e.alpha+=.01,e.alpha>=1&&clearInterval(t)},10)}}function pe(){let e=ie(),t=e.x,a=e.y;for(let e=0;e<1e4&&F.some(e=>e.x===t&&e.y===a)||X.some(e=>e.x===t&&e.y===a);e++){let r=ie();if(t=r.x,a=r.y,e>=9999)return}let r=i(s(t)),o=i(s(a))+9,n=N[Math.floor(Math.random()*N.length)],l=Unicorn.AddObject("trap"+A++,{type:"circle",sprite:n,x:r,y:o,radius:24,isStatic:!0});l.sprite.scale.x=3,l.sprite.scale.y=3,X.push({x:t,y:a,type:n,sprite:l})}function he(e=-1,t=-1,a=null){if(e<0||t<0){let a=ie();e=a.x,t=a.y;for(let a=0;a<1e4&&F.some(a=>a.x===e&&a.y===t)||X.some(a=>a.x===e&&a.y===t);a++){let r=ie();if(e=r.x,t=r.y,a>=9999)return}}let r=i(s(e)),o=i(s(t))+9;a||(a=R[Math.floor(Math.random()*R.length)]);let n=null;if(y.animatedPrizes&&y.animatedPrizes[a]){let e={},t="prize"+A;if(y.animatedPrizes[a].appears){e.appears={framerate:.1,frames:[],loop:!1,onComplete:()=>{Unicorn.PlayObjectAnimation(t,"shine")}};for(let t=0;t<y.animatedPrizes[a].appears;t++)e.appears.frames.push(`${a}_appears${t}`)}if(y.animatedPrizes[a].shine){e.shine={framerate:.1,frames:[],loop:!0};for(let t=0;t<y.animatedPrizes[a].shine;t++)e.shine.frames.push(`${a}_shine${t}`)}else e.shine={framerate:.1,frames:[a],loop:!0};n=Unicorn.AddObject("prize"+A++,{type:"circle",animations:e,x:r,y:o,z:1,radius:24,scale:{x:3,y:3},isStatic:!0})}else n=Unicorn.AddObject("prize"+A++,{type:"circle",sprite:a,x:r,y:o,z:1,radius:24,scale:{x:3,y:3},isStatic:!0});F.push({x:e,y:t,type:a,sprite:n})}function fe(){me(".boss",x+ ++A,Object.keys(p)[Math.floor(Math.random()*Object.keys(p).length)],y.defaultNameColor||"#ffffff",y.bossCharacter,!0)}function de(){let e=Object.keys(J).filter(e=>!J[e].isBoss).map(e=>{return{score:J[e].points,name:(t=J[e].name,a=11,t.length>a?t.substring(0,a)+"…":t),fullName:J[e].name};var t,a});e.sort((e,t)=>t.score-e.score);let t=e;L.text=t.map(e=>e.name+": "+e.score).slice(0,14).join("\n"),t.length>0&&t[0].score>0?Q=t[0].fullName:(Q=null,z.x=-1e3,z.y=-1e3)}async function me(t,a,r,o="#ffffff",l="",c=!1){de();let f=-1,b=-1;if(h(r)){let e=p[r.toUpperCase()];f=e.x,b=e.y}let M="";if(f>=0&&b>=0&&f<20&&b<11){let r,p;if(oe.forEach(e=>{Unicorn.RemoveObject(e.label)}),oe=[],J[a]){if(J[a].isTeleporting)return;if(J[a].hp<=0)return;if(J[a].path.length>0?(r=J[a].path[0].x,p=J[a].path[0].y):(J[a].progress=1,r=J[a].x,p=J[a].y),y.characters[l]&&J[a].character!==l){console.log(J[a]);let e={front:[],back:[],left:[],right:[]};if("ghost"===l)for(let t=0;t<18;t++)Object.keys(e).forEach(a=>{e[a].push(y.characters[l]+t)});else for(let t=0;t<10;t++)Object.keys(e).forEach(a=>{e[a].push(y.characters[l]+"_"+a+t)});let t=16/60;c&&(t=.2),J[a].isTeleporting&&(t=160/60);let r=J[a].sprite.position.x,o=J[a].sprite.position.y;Unicorn.RemoveObject("player_"+a),J[a].sprite=Unicorn.AddObject("player_"+a,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:t,frames:e.front,loop:!0},back:{framerate:t,frames:e.back,loop:!0},left:{framerate:t,frames:e.left,loop:!0},right:{framerate:t,frames:e.right,loop:!0}},x:r,y:o,z:100,radius:24,isStatic:!0}),J[a].character=l}}else{let e={};try{let a=await fetch(`${d}/accounts/twitch/design?username=${t}`).then(e=>e.json());a&&(e=a.style||{})}catch(e){console.log(e)}y.characters[l]&&(c||l!==y.bossCharacter)||(e.character?(y.characters[e.character.id]||(y.characters[e.character.id]=e.character.path,V.forEach(t=>{let a=e.character.path+"_"+t;for(let t=1;t<11;t++)Unicorn.Load(a+(t-1),`${g}/assets/characters/${e.character.id}/${a}/${a}${t}.png`)})),l=e.character.id):l=y.playable[Math.floor(y.playable.length*Math.random())]),e.pet&&(y.pets||(y.pets={}),M=e.pet.id.replace("pet_",""),y.pets[M]||(y.pets[M]={path:e.pet.path,minIdle:e.pet.minIdle,maxIdle:e.pet.maxIdle},V.forEach(t=>{let a=e.pet.path+"_"+t;for(let e=1;e<11;e++)Unicorn.Load("pet_"+a+(e-1),`${g}/assets/pets/${M}/${a}/${a}${e}.png`)}))),Object.keys(J).length===(u.addBoss?$:0)&&(setTimeout(()=>{let e=setInterval(()=>{C.alpha-=.01,v.alpha-=.01,C.alpha<=0&&clearInterval(e)},10)},5e3),y.giftDrop&&setTimeout(()=>{se()},12e4+12e4*Math.random())),r=s(10),p=s(5);let n={front:[],back:[],left:[],right:[]};if("ghost"===l)for(let e=0;e<18;e++)Object.keys(n).forEach(t=>{n[t].push(y.characters[l]+e)});else for(let e=0;e<10;e++)Object.keys(n).forEach(t=>{n[t].push(y.characters[l]+"_"+t+e)});let h=16/60;c&&(h=.2);let f=Unicorn.AddObject("player_"+a,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:h,frames:n.front,loop:!0},back:{framerate:h,frames:n.back,loop:!0},left:{framerate:h,frames:n.left,loop:!0},right:{framerate:h,frames:n.right,loop:!0}},x:-1e3,y:-1e3,z:100,radius:24,isStatic:!0}),b=null;if(M){let e={front:[],back:[],left:[],right:[]};for(let t=0;t<10;t++)Object.keys(e).forEach(a=>{e[a].push("pet_"+y.pets[M].path+"_"+a+t)});b=Unicorn.AddObject("pet_"+a,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:h,frames:e.front,loop:!0},back:{framerate:h,frames:e.back,loop:!0},left:{framerate:h,frames:e.left,loop:!0},right:{framerate:h,frames:e.right,loop:!0}},x:r,y:p,z:100,radius:24,isStatic:!0})}let O=tinycolor(o);if("Cupid Heart Collection"===m&&("boybear"===l||"girlbear"===l)){let e=PIXI.utils.string2hex(O.brighten(50).toHexString());f.animations.front.tint=e,f.animations.back.tint=e,f.animations.left.tint=e,f.animations.right.tint=e}if(J[a]={username:t,name:a,isBoss:c,x:r,y:p,progress:1,path:[],points:0,hp:100,label:Unicorn.AddText(a,c?x:a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:o,lineJoin:"round",stroke:tinycolor.isReadable(O.toString(),y.scoreboardColor||"#000000")?y.scoreboardColor||"#000000":y.defaultNameColor||"#ffffff",strokeThickness:6}),scoreLabel:Unicorn.AddText(a+"_points","0",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:y.scoreColor||"#000000",lineJoin:"round",stroke:y.defaultNameColor||"#ffffff",strokeThickness:6}),sprite:f,character:l,pet:M,petSprite:b,petDirection:"front",petIdle:0,petSpeed:1,petGoalX:i(r),petGoalY:i(p)},y.lightCharacters){_[a]=PIXI.Sprite.from(`${g}/assets/effects/light_glow.png`),_[a].scale={x:10,y:10},_[a].anchor.set(.5);let e=PIXI.utils.string2hex(O.brighten(60).toHexString());_[a].tint=e,k.addChild(_[a])}}J[a].idleTimer=45e3;let h=function(t,a,r,o,n,s,i){if(o===s&&n===i)return[{x:o,y:n}];if(o<0||o>=a||n<0||n>=r)return null;if(t[n*a+o]>0)return null;let l=[{x:o,y:n,score:e(o,n,s,i),path:[]}],c=t.slice();for(;l.length>0;){let t=l.shift();if(t.x===s&&t.y===i)return t.path.concat({x:t.x,y:t.y});if(t.x<0||t.x>=a||t.y<0||t.y>=r);else if(c[t.y*a+t.x]>0);else{c[t.y*a+t.x]=2;let r=t.path.concat({x:t.x,y:t.y});l.push({x:t.x,y:t.y-1,score:e(t.x,t.y-1,s,i),path:r}),l.push({x:t.x+1,y:t.y,score:e(t.x+1,t.y,s,i),path:r}),l.push({x:t.x,y:t.y+1,score:e(t.x,t.y+1,s,i),path:r}),l.push({x:t.x-1,y:t.y,score:e(t.x-1,t.y,s,i),path:r}),l.sort((t,a)=>e(t.x,t.y,s,i)-e(a.x,a.y,s,i)+t.path.length-a.path.length)}}return null}(n,41,23,r,p,s(f),s(b));J[a].path=h}}function ye(e,t,a,r,o){if(!w&&"play"===t){q[e]=!0;let t=["E10","E11","E12","F10","F11","F12"];me(o.username,e,t[Math.floor(Math.random()*t.length)],o.userColor||y.scoreColor||"#ffffff",a.toLowerCase())}if(w||("wander"===t?(q[e]=!0,me(o.username,e,Object.keys(p)[Math.floor(Math.random()*Object.keys(p).length)],o.userColor||y.scoreColor||"#ffffff",a.toLowerCase()).then(t=>{J[e].wander=!0})):"unwander"===t&&J&&J[e]&&delete J[e].wander),r.broadcaster||r.mod){if("starttag"!==t&&"tag"!==t||(Y=Object.keys(J)[Math.floor(Math.random()*Object.keys(J).length)]),w||"prize"!==t||he(),"end"===t){w=!0,setInterval(()=>{for(let e=0;e<Z.length;e++)Z[e].alpha=0;K=(K+1)%Z.length;let e=Math.floor(Z.length*Math.random());Z[e].alpha=1},300),Z[0].alpha=1,T.alpha=1,P.alpha=1,E.alpha=1,L.alpha=1;for(let e in J){let t=J[e];t.label.alpha=0,t.scoreLabel.alpha=0}let e=-1;if(a&&(e=parseInt(a)),u.messageFormat){let t=u.messageFormat,a=Object.keys(J).filter(e=>!J[e].isBoss).map(e=>({score:J[e].points,name:J[e].name}));a.sort((e,t)=>t.score-e.score),e>0&&(a=a.slice(0,e)),a.forEach((e,a)=>{if(e.score>0&&e.name!==x){let r=t.replace("USERNAME",e.name).replace("POINTS",e.score);setTimeout(()=>{ComfyJS.Say(r)},1e3*a)}})}}"reset"!==t&&"restart"!==t&&"refresh"!==t||location.reload()}}function ue(e,t,a,r,o){!w&&h(t)&&(q[e]=!0,me(o.username,e,t,o.userColor||y.scoreColor||"#ffffff"))}async function ge(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then(e=>e.json()).catch(e=>({error:e}))}async function xe(e){return await fetch(`https://api.pixelplush.dev/v1/auth/refresh?token=${e}`).then(e=>e.json()).catch(e=>({error:e}))}var be="";async function Me(){let e=Object.keys(q).length;return fetch(`${d}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:be,game:"maze",theme:m,channel:u.channel,players:Object.keys(q),count:e})}).then(e=>e.json())}window.setupGame=function(e,t,a){m=e,y=t,u=a,x=y.bossName,g=y.path||"",Object.keys(y.trapRarity).forEach(e=>{for(let t=0;t<y.trapRarity[e];t++)N.push(e)}),u.giftDrop&&(B=u.giftDrop),Object.keys(y.prizeRarity).forEach(e=>{if(e!==B)for(let t=0;t<y.prizeRarity[e];t++)R.push(e)}),S=Math.max(0,Math.min(214,u.numPrizes)),I=Math.max(0,Math.min(214,u.numTraps)),$=u.numBosses,b=u.bossEffect||"steal",M=u.trapEffect||"points"};